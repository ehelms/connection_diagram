digraph G {
	graph [compound=true]
	
	subgraph cluster_isolated {
		label="Isolated Client"
		// style=filled;
		"Isolated Yum" [shape=box];
		"Isolated RHSM / SubsMan" [shape=box];
		"Isolated Puppet" [shape=box];
		"Isolated Katello Agent / Gofer" [shape=box];
	}

	subgraph cluster_capsule {
		label="Capsule"
		// style=filled;
		"Smart Proxy / Foreman Proxy" [shape=box];
		"Dispatch Router / Qrouterd" [shape=box];
		"Qpid" [shape=box];
		"MongoDB" [shape=box];
		
		subgraph cluster_apache {
			label="Apache"
			"Puppet Master" [shape=box];
			
			subgraph cluster_pulp {
				label="Pulp"
				"pulp_* process" [shape=box];
				"API" [shape=box];
			}
			

		}
	}

"Isolated Yum" -> "Puppet Master" [lhead=cluster_apache, label="443", color="green"];
"Isolated Yum" -> "Puppet Master" [lhead=cluster_apache, label="80", color="red"];

"Isolated RHSM / SubsMan" -> "Puppet Master" [lhead=cluster_apache, label="8443", color="green"];

"Isolated Puppet" -> "Puppet Master" [label="443", color="green"];
"Isolated Puppet" -> "Puppet Master" [label="8140", color="green"];

"Isolated Katello Agent / Gofer" -> "Dispatch Router / Qrouterd" [label="5647", color="green"];

"pulp_* process" -> "Qpid" [label="hostname:5671", color="green"];
"pulp_* process" -> "MongoDB" [label="localhost:27017", color="red"];

"API" -> "Qpid" [label="hostname:5671", color="green"];
"API" -> "MongoDB" [label="localhost:27017", color="red"];

}
